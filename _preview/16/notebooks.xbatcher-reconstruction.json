{"version":2,"kind":"Notebook","sha256":"7240864d052b2fd475e00067df0f2c07e3c6ef1d40f8dcaa29fc670819106c7a","slug":"notebooks.xbatcher-reconstruction","location":"/notebooks/xbatcher_reconstruction.ipynb","dependencies":[],"frontmatter":{"title":"Reconstructing Xarray Datasets from Model Outputs","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"cookbook-dev","language":"python"},"authors":[{"nameParsed":{"literal":"Keenan Ganz, Nabin Kalauni, and The Project Pythia Community","given":"and The Project Pythia Community","family":"Keenan Ganz","suffix":"Nabin Kalauni"},"name":"Keenan Ganz, Nabin Kalauni, and The Project Pythia Community","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/xbatcher-deep-learning","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/xbatcher-deep-learning/blob/HEAD/notebooks/xbatcher_reconstruction.ipynb","exports":[{"format":"ipynb","filename":"xbatcher_reconstruction.ipynb","url":"/xbatcher-deep-learning/_preview/16/build/xbatcher_reconstruct-69ce59e53e5408ff7cba822622e22a05.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qg4phZn0FM"}],"key":"n36sVfVUCI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gqOgDIOkdo"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"VOrjiVMvpy"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook addresses the process of reconstructing an ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FH8CO19Dxo"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"G5gyqBXYme"},{"type":"text","value":" from the output of a machine learning model. While the previous notebook focused on generating batches from ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xtt1NjQiSp"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oczWj2zlfH"},{"type":"text","value":" objects, this guide details the reverse process: assembling model outputs back into a coherent, labeled ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jvezfcowhv"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fuPgZBdP5r"},{"type":"text","value":" object. This is a common requirement in scientific machine learning workflows, where the model output needs to be analyzed in its original spatial or temporal context.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"se17afAmkw"}],"key":"xHN4VbvKBs"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will examine a function that reassembles model outputs, including a detailed look at how an internal API of ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CNlzz6rczt"},{"type":"inlineCode","value":"xbatcher","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ppUTl0nVjG"},{"type":"text","value":" can be used to map batch outputs back to their original coordinates.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Dfm3SR1pfY"}],"key":"AJOWPOfZt0"}],"key":"T7eqCbNMIV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SJ19bo18NN"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"yGpJyBMMEp"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Vwhl6Mn8R4"}],"key":"wH0zSmMBp9"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FJ9QgFMJ4v"}],"key":"WViWJJuCzA"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N0ZtpWWgej"}],"key":"c08jZGVaX6"}],"key":"DTsBEkfoRz"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://tutorial.xarray.dev/overview/xarray-in-45-min.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Intro to Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Fyehd9bnLf"}],"urlSource":"https://tutorial.xarray.dev/overview/xarray-in-45-min.html","key":"zYIH0Dv73g"}],"key":"WdrBY2FBTi"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oFRuBGvo1f"}],"key":"h3VwUR3Nn6"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Array indexing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qjEoqS9XjK"}],"key":"e1SuMJ0TXQ"}],"key":"JRcSbwf2iK"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://projectpythia.org/xbatcher-deep-learning/notebooks/xbatcher-dataloading/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Loading Batches from Xarray","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"zSDf2Ok5Lr"}],"urlSource":"https://projectpythia.org/xbatcher-deep-learning/notebooks/xbatcher-dataloading/","key":"GgAWeqiUfX"}],"key":"CDsNRKbxvg"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WuASiP4O8C"}],"key":"EcANUoCvm5"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"PyTorch DataLoader API","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RQ3kJayPCA"}],"key":"IJsR6ZaDKn"}],"key":"pZF7YuMTgV"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.pytorch.org/tutorials/beginner/basics/intro.html","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"PyTorch fundamentals","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FxkRaHIIin"}],"urlSource":"https://docs.pytorch.org/tutorials/beginner/basics/intro.html","key":"Sfv7taiR9A"}],"key":"q5EsyjujTI"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ds5vJGGdjq"}],"key":"Wyv8ryO3GD"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Model training loop","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HtDDLqKxp9"}],"key":"CeLhq0K5i6"}],"key":"JT42kv4FcE"}],"key":"TKF4umskgk"}],"key":"MbYWi5sfFW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UBJchcuuML"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"g5VcJSNG34"}],"key":"JPGv1yW7HI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport numpy as np\nimport torch\nimport xbatcher\nfrom xbatcher.loaders.torch import MapDataset\nfrom typing import Literal\n\nfrom dummy_models import ExpandAlongAxis","key":"eL1XXZhYRi"},{"type":"output","id":"rDn_NfsJ2FRT2UVt-oT6X","data":[],"key":"ivzvJHpEj9"}],"key":"FHhVX5ScKm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup: Data, Batches, and a Dummy Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OgggC1fWPB"}],"identifier":"setup-data-batches-and-a-dummy-model","label":"Setup: Data, Batches, and a Dummy Model","html_id":"setup-data-batches-and-a-dummy-model","implicit":true,"key":"EJF0Q0F09F"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will begin by creating a sample ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nxvXGR6Dgu"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UC4h3hLAQ8"},{"type":"text","value":" and a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aTSHYj9LuX"},{"type":"inlineCode","value":"BatchGenerator","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LFkAlgDvn9"},{"type":"text","value":". We will also instantiate a dummy model that transforms the data, simulating a common machine learning scenario where the output dimensions differ from the input dimensions (e.g., super-resolution).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S3NHgWlvPD"}],"key":"XNKs6S2lwc"}],"key":"dzNJIWKf0z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"da = xr.DataArray(\n    data=np.random.rand(50, 40).astype(np.float32),\n    dims=(\"x\", \"y\"),\n    coords={\"x\": np.arange(50), \"y\": np.arange(40)},\n)\nda","key":"ZbpDNvAOuo"},{"type":"output","id":"Zj7pS_CXqBzWaygRX82Qt","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"<xarray.DataArray (x: 50, y: 40)> Size: 8kB\narray([[0.14552103, 0.6962143 , 0.9910823 , ..., 0.9957098 , 0.59161043,\n        0.05098144],\n       [0.34910998, 0.29745623, 0.33441734, ..., 0.4308236 , 0.0435599 ,\n        0.3456366 ],\n       [0.5291245 , 0.60865587, 0.40649942, ..., 0.10275818, 0.20667703,\n        0.13572831],\n       ...,\n       [0.494566  , 0.49760878, 0.78625613, ..., 0.14144538, 0.4671493 ,\n        0.6302006 ],\n       [0.37885144, 0.8857868 , 0.69549334, ..., 0.7529592 , 0.13820523,\n        0.42774028],\n       [0.97200435, 0.6066912 , 0.85733825, ..., 0.59305775, 0.80259395,\n        0.9364576 ]], shape=(50, 40), dtype=float32)\nCoordinates:\n  * x        (x) int64 400B 0 1 2 3 4 5 6 7 8 9 ... 41 42 43 44 45 46 47 48 49\n  * y        (y) int64 320B 0 1 2 3 4 5 6 7 8 9 ... 31 32 33 34 35 36 37 38 39","content_type":"text/plain"},"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (x: 50, y: 40)&gt; Size: 8kB\narray([[0.14552103, 0.6962143 , 0.9910823 , ..., 0.9957098 , 0.59161043,\n        0.05098144],\n       [0.34910998, 0.29745623, 0.33441734, ..., 0.4308236 , 0.0435599 ,\n        0.3456366 ],\n       [0.5291245 , 0.60865587, 0.40649942, ..., 0.10275818, 0.20667703,\n        0.13572831],\n       ...,\n       [0.494566  , 0.49760878, 0.78625613, ..., 0.14144538, 0.4671493 ,\n        0.6302006 ],\n       [0.37885144, 0.8857868 , 0.69549334, ..., 0.7529592 , 0.13820523,\n        0.42774028],\n       [0.97200435, 0.6066912 , 0.85733825, ..., 0.59305775, 0.80259395,\n        0.9364576 ]], shape=(50, 40), dtype=float32)\nCoordinates:\n  * x        (x) int64 400B 0 1 2 3 4 5 6 7 8 9 ... 41 42 43 44 45 46 47 48 49\n  * y        (y) int64 320B 0 1 2 3 4 5 6 7 8 9 ... 31 32 33 34 35 36 37 38 39</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>x</span>: 50</li><li><span class='xr-has-index'>y</span>: 40</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-bda512dd-282e-454e-8222-97e44d35e8e6' class='xr-array-in' type='checkbox' checked><label for='section-bda512dd-282e-454e-8222-97e44d35e8e6' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.1455 0.6962 0.9911 0.3706 0.6335 ... 0.2018 0.5931 0.8026 0.9365</span></div><div class='xr-array-data'><pre>array([[0.14552103, 0.6962143 , 0.9910823 , ..., 0.9957098 , 0.59161043,\n        0.05098144],\n       [0.34910998, 0.29745623, 0.33441734, ..., 0.4308236 , 0.0435599 ,\n        0.3456366 ],\n       [0.5291245 , 0.60865587, 0.40649942, ..., 0.10275818, 0.20667703,\n        0.13572831],\n       ...,\n       [0.494566  , 0.49760878, 0.78625613, ..., 0.14144538, 0.4671493 ,\n        0.6302006 ],\n       [0.37885144, 0.8857868 , 0.69549334, ..., 0.7529592 , 0.13820523,\n        0.42774028],\n       [0.97200435, 0.6066912 , 0.85733825, ..., 0.59305775, 0.80259395,\n        0.9364576 ]], shape=(50, 40), dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-b66342fd-a544-4aaa-8d95-8a5cba776d7c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b66342fd-a544-4aaa-8d95-8a5cba776d7c' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 44 45 46 47 48 49</div><input id='attrs-4198cf7c-6af1-4ea7-9170-1c032e71d32a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4198cf7c-6af1-4ea7-9170-1c032e71d32a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-100652d0-1baa-4489-8f79-9a1c815ec499' class='xr-var-data-in' type='checkbox'><label for='data-100652d0-1baa-4489-8f79-9a1c815ec499' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,\n       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 34 35 36 37 38 39</div><input id='attrs-d7bb173e-106f-4ae8-adeb-e24d8593e7bb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d7bb173e-106f-4ae8-adeb-e24d8593e7bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d5ae9e09-8249-426b-9b6c-f4b41f8b9df3' class='xr-var-data-in' type='checkbox'><label for='data-d5ae9e09-8249-426b-9b6c-f4b41f8b9df3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,\n       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n       36, 37, 38, 39])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-82df3e72-a506-482b-a12d-3eb884bb33c5' class='xr-section-summary-in' type='checkbox'  ><label for='section-82df3e72-a506-482b-a12d-3eb884bb33c5' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-485e62db-c6ff-49b1-a9b8-0f09ee2aefb0' class='xr-index-data-in' type='checkbox'/><label for='index-485e62db-c6ff-49b1-a9b8-0f09ee2aefb0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,\n       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],\n      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ebf3b842-d21c-48b3-8eaa-0fccf0556adc' class='xr-index-data-in' type='checkbox'/><label for='index-ebf3b842-d21c-48b3-8eaa-0fccf0556adc' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,\n       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n       36, 37, 38, 39],\n      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7fca3e93-5feb-45e2-ba05-062cd5f9d044' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7fca3e93-5feb-45e2-ba05-062cd5f9d044' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"}}}],"key":"x7gD3Ta3Fj"}],"key":"JBrLDgaU1u"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we create the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A7FUyeo2tm"},{"type":"inlineCode","value":"BatchGenerator","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g3PknFjaBX"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OpqE4dKOyi"}],"key":"MBq9pyquPd"}],"key":"KuZuDKKpqW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bgen = xbatcher.BatchGenerator(da, input_dims={\"x\": 10, \"y\": 10})","key":"NlWbAz9FQV"},{"type":"output","id":"bCM6p8aJEEULiG-PnCCAd","data":[],"key":"g8ltfWu2PR"}],"key":"P4NCEcCjvy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For the model, we will use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UhOaQYu3EU"},{"type":"inlineCode","value":"ExpandAlongAxis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rqIOHi78uo"},{"type":"text","value":" from ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FqCgBR4tIC"},{"type":"inlineCode","value":"dummy_models.py","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wUNrOR6bm6"},{"type":"text","value":". This model upsamples the input along a specified axis, changing the dimensions of the data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YhwodwWQXG"}],"key":"zjTNocRoRl"}],"key":"YKDVLzjLFk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# The model will expand the 'x' dimension by a factor of 2\nmodel = ExpandAlongAxis(ax=1, n_repeats=2)","key":"peku68gey0"},{"type":"output","id":"ZVitzA6QiU7mwRNZ5ytYB","data":[],"key":"xOxB2TQZJQ"}],"key":"uHjNdhFU4b"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reconstructing the Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AVpFZWGcdR"}],"identifier":"reconstructing-the-dataset","label":"Reconstructing the Dataset","html_id":"reconstructing-the-dataset","implicit":true,"key":"wLULKFlYEa"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will now use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rdhGy5xgmT"},{"type":"inlineCode","value":"predict_on_array","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rumAJpnwNL"},{"type":"text","value":" function to reconstruct the dataset. The most important part of using this function is correctly specifying the arguments ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r5aSn5IyUC"},{"type":"inlineCode","value":"new_dim","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yDNPSxHfZ0"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IYfK38cpo8"},{"type":"inlineCode","value":"core_dim","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NjlnYVVyTw"},{"type":"text","value":", and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pg725JrY1j"},{"type":"inlineCode","value":"resample_dim","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kbSuoGBknt"},{"type":"text","value":". These lists all contain dimensions given in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KGAXSIj6VY"},{"type":"inlineCode","value":"output_tensor_dim","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MBYbmv95Yh"},{"type":"text","value":" and help us get an idea of how model output compares to the input data. In general:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hYCyUtZMQM"}],"key":"nNNmwnEVLh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"new_dim","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dlhPvaV0in"},{"type":"text","value":": Tensor dimensions that do not appear at all in the original xarray object.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ss6wT4lee8"}],"key":"uRh6gosS6N"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"inlineCode","value":"core_dim","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JdUGSKWgMq"},{"type":"text","value":": Tensor dimensions that are present in the original xarray object, but are not used for batch generation. We assume that all elements of this dimension in the xarray object flow through the model to the output. Coordinates are simply copied from the original xarray object.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mvTqjGNYDS"}],"key":"mGBrQ71Wwv"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"resample_dim","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mcA7NLNaqn"},{"type":"text","value":": Tensor dimensions that are present in the original xarray object ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SxkFSZ3H3h"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"and","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"omeuci4KAp"}],"key":"MdfLjxbCJB"},{"type":"text","value":" used for batch generation. These dimensions are allowed to change size (but see below note) and coordinates are resampled accordingly in the reconstructed array.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hxRpQUwZ16"}],"key":"IZVe0Yp1j4"}],"key":"Mk4YKtbH9l"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Let’s apply these rules to our present example. The batch generator creates tensors of size ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"KThIgKpZxv"},{"type":"inlineCode","value":"(x=10, y=10)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HhYOopBqAx"},{"type":"text","value":" and the dummy model makes tensors of size ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JU6ukJuXfK"},{"type":"inlineCode","value":"(x=20, y=10)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"uGMSZXWX0V"},{"type":"text","value":". In this case, all tensor dimensions are present in the original data array and are used for batch generation. Therefore, both ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NsfSIRLEIk"},{"type":"inlineCode","value":"x","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"id8fbPkfA7"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"flBHiS7wtG"},{"type":"inlineCode","value":"y","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"F0eQw44wmD"},{"type":"text","value":" go in ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fFkX64vxCV"},{"type":"inlineCode","value":"resample_dim","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IoPF9Q1lc8"},{"type":"text","value":". Now that all tensor dimensions are accounted for, we can simply leave ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"kxaOp58rov"},{"type":"inlineCode","value":"new_dim","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"i08LvKts9S"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CPLl8Y0CAC"},{"type":"inlineCode","value":"core_dim","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RHE6FyCuZY"},{"type":"text","value":" as empty lists.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"BHZI67v2kr"}],"key":"XFgQhLgh0t"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Changing dimension sizes","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZS6A11QEj2"}],"key":"KneCDYnAcp"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Dimensions in ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"zJ0ogVaVVU"},{"type":"inlineCode","value":"resample_dim","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"lWzNjwII1i"},{"type":"text","value":" must upsample or downsample by a factor that implies an integer size in the output data array. For example, in this example we generated tensors of size ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"FbRpluOFxf"},{"type":"inlineCode","value":"(x=10, y=10)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"PmSHmO2Jvz"},{"type":"text","value":" and the model generates tensors of size ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"fWM98NRxbI"},{"type":"inlineCode","value":"(x=20, y=10)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"LemGxoFVZ8"},{"type":"text","value":". This implies that we are ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"egq8ve0g0v"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"upsampling","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"uj3Uka3ynX"}],"key":"Is9vqNVEPe"},{"type":"text","value":" ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"XqTMZgChbj"},{"type":"inlineCode","value":"x","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"JSDIhavO21"},{"type":"text","value":" by a factor of 2. The original data array has size of 50 in the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RonCrzQrsC"},{"type":"inlineCode","value":"x","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gAtnSo7pvq"},{"type":"text","value":" dimension, and ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"eR3hJq5BnQ"},{"type":"inlineCode","value":"50 * 2 = 100","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"YGfXZZcwx8"},{"type":"text","value":" is an integer, so this is allowed.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"AwAJseuK6v"}],"key":"xtHiJxMKmZ"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"What if, for some reason, the batch generator made tensors of size ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"oNerEytqsz"},{"type":"inlineCode","value":"(x=7, y=7)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FEFTQFoEhI"},{"type":"text","value":" and the model generated tensors of size ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"EaMoOvIlSf"},{"type":"inlineCode","value":"(x=10, y=10)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"StcRtBx97s"},{"type":"text","value":"? The resampling factor becomes ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"VY3hdMYKJF"},{"type":"inlineCode","value":"10/7","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"i9IjPDOlhT"},{"type":"text","value":", and the implied output data array size is ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"mMPdIksMXn"},{"type":"inlineCode","value":"(50 * 10/7) = 72.43","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"CSsJcEjNks"},{"type":"text","value":". This is not an integer, so ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"HwUuhdb2yE"},{"type":"inlineCode","value":"predict_on_array","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Ycgpd66j7R"},{"type":"text","value":" will throw an error.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"UTnmZm7wUb"}],"key":"HVYD2W1KAn"}],"class":"tip","key":"yyhigZaADo"}],"key":"bK07I1Icdt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"map_dataset = MapDataset(bgen)\nreconstructed_da = predict_on_array(\n    dataset=map_dataset,\n    model=model,\n    output_tensor_dim={\"x\": 20, \"y\": 10}, # The model doubles the x-dimension\n    new_dim=[],\n    core_dim=[],\n    resample_dim=[\"x\", \"y\"],\n    batch_size=4,\n    progress_bar=False\n)\nreconstructed_da","key":"JO4tYigDqE"},{"type":"output","id":"ysMDfk40s3kxXM4ia3YO9","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mNameError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[5]\u001b[39m\u001b[32m, line 2\u001b[39m\n\u001b[32m      1\u001b[39m map_dataset = MapDataset(bgen)\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m reconstructed_da = \u001b[43mpredict_on_array\u001b[49m(\n\u001b[32m      3\u001b[39m     dataset=map_dataset,\n\u001b[32m      4\u001b[39m     model=model,\n\u001b[32m      5\u001b[39m     output_tensor_dim={\u001b[33m\"\u001b[39m\u001b[33mx\u001b[39m\u001b[33m\"\u001b[39m: \u001b[32m20\u001b[39m, \u001b[33m\"\u001b[39m\u001b[33my\u001b[39m\u001b[33m\"\u001b[39m: \u001b[32m10\u001b[39m}, \u001b[38;5;66;03m# The model doubles the x-dimension\u001b[39;00m\n\u001b[32m      6\u001b[39m     new_dim=[],\n\u001b[32m      7\u001b[39m     core_dim=[],\n\u001b[32m      8\u001b[39m     resample_dim=[\u001b[33m\"\u001b[39m\u001b[33mx\u001b[39m\u001b[33m\"\u001b[39m, \u001b[33m\"\u001b[39m\u001b[33my\u001b[39m\u001b[33m\"\u001b[39m],\n\u001b[32m      9\u001b[39m     batch_size=\u001b[32m4\u001b[39m,\n\u001b[32m     10\u001b[39m     progress_bar=\u001b[38;5;28;01mFalse\u001b[39;00m\n\u001b[32m     11\u001b[39m )\n\u001b[32m     12\u001b[39m reconstructed_da\n\n\u001b[31mNameError\u001b[39m: name 'predict_on_array' is not defined","ename":"NameError","evalue":"name 'predict_on_array' is not defined"}],"key":"ntD5f5uw1U"}],"key":"vgtj8GFfxF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The reconstructed ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S0BPH5ykvt"},{"type":"inlineCode","value":"DataArray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IF3FUFG8VB"},{"type":"text","value":" has the upsampled ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DVjj6sgXqC"},{"type":"inlineCode","value":"x","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d7ZBmA78GW"},{"type":"text","value":" dimension. We can compare its shape to the original.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tshKyiJCzg"}],"key":"XasDjLZjtT"}],"key":"N5PHkc3Mj0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"Original shape: {da.shape}\")\nprint(f\"Reconstructed shape: {reconstructed_da.shape}\")","key":"HoP5KVsTgF"},{"type":"output","id":"XBlU2jwZ70e57J4L6Jeis","data":[],"key":"zhmLvOjRZN"}],"key":"KfeoYwZKgI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The reconstructed array has twice the number of elements in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gPLhdTlBd5"},{"type":"inlineCode","value":"x","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SxQW3s6gWB"},{"type":"text","value":" dimension, as expected.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VYy453t7GW"}],"key":"bVlFacW44J"}],"key":"qjsu4oHvTr"}],"key":"xDpImaEmCL"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Loading Batches from Xarray Objects","url":"/notebooks/xbatcher-dataloading","group":"Xbatcher fundamentals"},"next":{"title":"Using xbatcher to train an autoencoder","url":"/notebooks/autoencoder","group":"Example with topography data"}}},"domain":"http://localhost:3000"}